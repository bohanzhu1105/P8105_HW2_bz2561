P8105_HW2_bz2561
================
Bohan Zhu
2025-09-23

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
```

## Problem 1

Import `pols_month`

``` r
pols_month_df =
  read_csv("data/fivethirtyeight/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day")) |> 
  mutate(
    month = month (
      as.integer(month),
      label = TRUE,
      abbr = FALSE
    )
  ) |> 
  mutate(
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem")
  ) |>
  select(-c(prez_gop,prez_dem,day))
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Import `snp`

``` r
snp_df =
  read_csv("data/fivethirtyeight/snp.csv") |> 
  janitor::clean_names() |> 
  mutate(date = as.Date(date, format = "%m/%d/%y")) |> 
  separate(date, into = c("year", "month", "day")) |> 
  mutate(
    month = month (
      as.integer(month),
      label = TRUE,
      abbr = FALSE
    )
  ) |> 
  select(-day) |> 
  relocate(year,everything()) |> 
  arrange(year,month)
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Import `unemployment`

``` r
unemployment_df =
  read_csv("data/fivethirtyeight/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = jan:dec,
    names_to = "month",
    values_to = "unemployment_percentage"
  ) |> 
 mutate(
   month =
     month(
       parse_date_time(month, orders = "b"),
       label = TRUE,
       abbr = FALSE
     ),
   year = as.character(year)
 )
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Join the datasets

``` r
combined_df = pols_month_df |> 
  left_join(snp_df, by = c("year", "month")) |> 
  left_join(unemployment_df, by = c("year", "month")) 

head(combined_df)
```

    ## # A tibble: 6 × 11
    ##   year  month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##   <chr> <ord>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ## 1 1947  January       23      51     253      23      45     198 dem          NA
    ## 2 1947  February      23      51     253      23      45     198 dem          NA
    ## 3 1947  March         23      51     253      23      45     198 dem          NA
    ## 4 1947  April         23      51     253      23      45     198 dem          NA
    ## 5 1947  May           23      51     253      23      45     198 dem          NA
    ## 6 1947  June          23      51     253      23      45     198 dem          NA
    ## # ℹ 1 more variable: unemployment_percentage <dbl>

For the first dataset `pols-month`, after tidying, there are 9 variables
and 822 rows of data remaining. The year range is from 1947 to 2015. The
variables are: year, month, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem,
rep_dem, president.

For the second dataset `snp`, after tidying, there are 3 variables and
787 rows of data remaining. The year range is from 1969 to 2068. The
variables are: year, month, close.

For the third dataset `unemmployment`, after tidying, there are 3
variables and 816 rows of data remaining. The year range is from 1948 to
2015. The variables are: year, month, unemployment_percentage.

Now, I start to combine these three datasets. I use `left_join()` to
combine `snp` and `unemployment` these two datasets into `pols-month` by
there shared variable `year` and `month`. After merging, there are 11
variables and 822 rows of data remaining. The year range is from 1947 to
2015. The variables are: year, month, gov_gop, sen_gop, rep_gop,
gov_dem, sen_dem, rep_dem, president, close, unemployment_percentage.
Key variables include `year` and `month`, since they serve as indicators
of time. `President` reflects the impact of political party affiliation.
Close serves as an indicator of financial market performance, and
unemployment percentage reflects the overall economy as well as social
stability.

## Problem 2

Import `Mr.Trash Wheel`

``` r
mr_trash_wheel =
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = 1, range = "A2:N710",  na = c("NA",".","")) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    sports_balls = as.integer(sports_balls),
    group = "mr_trash_wheel",
    year = as.numeric(year)
         )
```

Import `Professor Trash Wheel`

``` r
prof_trash_wheel =
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = 2, range = "A2:M135",  na = c("NA",".","")) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    group = "prof_trash_wheel"
         )
```

Import `Gwynnda Trash Wheel`

``` r
gwynnda_trash_wheel =
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = 4, range = "A2:L352",  na = c("NA",".","")) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    group = "gwynnda_trash_wheel"
         )
```

Join the datasets

``` r
combined_trash = 
  bind_rows(mr_trash_wheel, prof_trash_wheel, gwynnda_trash_wheel) |> 
  janitor::clean_names() |> 
  relocate(group) 

head(combined_trash)
```

    ## # A tibble: 6 × 15
    ##   group  dumpster month  year date                weight_tons volume_cubic_yards
    ##   <chr>     <dbl> <chr> <dbl> <dttm>                    <dbl>              <dbl>
    ## 1 mr_tr…        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ## 2 mr_tr…        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ## 3 mr_tr…        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ## 4 mr_tr…        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ## 5 mr_tr…        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ## 6 mr_tr…        6 May    2014 2014-05-20 00:00:00        2.71                 13
    ## # ℹ 8 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>

``` r
prof_trash_wheel |>
  select(weight_tons) |>
  sum(na.rm = TRUE)
```

    ## [1] 282.26

``` r
gwynnda_trash_wheel |> 
  filter(month == "June", year == "2022") |> 
  select(cigarette_butts) |> 
  sum()
```

    ## [1] 18120

For the first dataset `Mr.Trash Wheel`, after tidying, there are 15
variables and 707 rows of data remaining. The year range is from 2014 to
2025.

For the second dataset `Professor Trash Wheel`, after tidying, there are
14 variables and 132 rows of data remaining. The year range is from 2017
to 2025.

For the third dataset `Gwynns Falls Trash Wheel`, after tidying, there
are 13 variables and 349 rows of data remaining. The year range is from
2021 to 2025.

Then, we combine three datasets together, after tidying, there are 15
variables and 1188 rows of data remaining. The year range is from 2014
to 2025. vairables that in the final combined dataset are: year, month,
gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, president, close,
unemployment_percentage. Key variables include ·`date` which records the
time of each observation, and `weight_tons`, which measures the total
weight of trash collected. `Plastic_bottles` is chosen as a
representative type of waste, showing how much plastic pollution was
captured. `Homes_powered` indicates the amount of electricity generated
from the collected waste.

Total weight of trash collected by Professor Trash Wheel equals
**282.26**.

And the total number of cigarette butts collected by Gwynnda in June of
2022 equals **18120**.

## Problem 3

``` r
zip_code_df =
  read_csv("data/zillow_data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  rename(borough = county) |> 
  mutate(borough = case_when(
    borough == "New York" ~ "Manhattan",
    borough == "Kings" ~ "Brooklyn",
    borough == "Richmond" ~ "Stateb_Island",
    TRUE ~ borough
    ),
    date = as.Date(file_date, format = "%m/%d/%y")
  ) |> 
  select(zip_code, borough,neighborhood) 
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zori_df = 
  read_csv("data/zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |> 
  rename(
    borough = county_name,
    zip_code = region_name) |> 
  mutate(borough = case_when(
    borough == "New York County" ~ "Manhattan",
    borough == "Kings County" ~ "Brooklyn",
    borough == "Richmond County" ~ "Stateb_Island",
    borough == "Queens County" ~ "Queens",
    borough == "Bronx County" ~"Bronx"
    ) 
  )|> 
  pivot_longer(
    cols = starts_with("x20"),     
    names_to = "date",             
    values_to = "value",
    names_prefix = "x"
  ) |> 
  mutate(
    date = as.Date(date, format = "%Y_%m_%d"),
  ) |> 
  select(zip_code, borough, date,value) 
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
combined_zillow = 
  left_join(zori_df, zip_code_df, by = c("zip_code", "borough"))|> 
  relocate(neighborhood, .after = borough) |> 
  arrange(zip_code)

head(combined_zillow)
```

    ## # A tibble: 6 × 5
    ##   zip_code borough   neighborhood        date       value
    ##      <dbl> <chr>     <chr>               <date>     <dbl>
    ## 1    10001 Manhattan Chelsea and Clinton 2015-01-31 3855.
    ## 2    10001 Manhattan Chelsea and Clinton 2015-02-28 3892.
    ## 3    10001 Manhattan Chelsea and Clinton 2015-03-31 3898.
    ## 4    10001 Manhattan Chelsea and Clinton 2015-04-30 3970.
    ## 5    10001 Manhattan Chelsea and Clinton 2015-05-31 4033.
    ## 6    10001 Manhattan Chelsea and Clinton 2015-06-30 4071.

After tidying, the final combined dataset include 5 variables and and
17284 rows of data remaining. vairables that in the final combined
dataset are: zip_code, borough, neighborhood, date, value. `zip_code`,
which serves as an indicator for location. `Borough` shows the broader
district to which the area belongs, while `neighborhood` provides a more
specific subdivision within the borough. `Date` records the time of
observation, and `value` represents the rental price at that given time.

There are total 17284 observations, **149** unique `zip code` and **42**
unique `neighborhood`.

``` r
combined_zillow |> 
  drop_na(zip_code, neighborhood) |> 
  summarise(
    total = n(),
    unique_zip = n_distinct(zip_code),
    unique_neighbor = n_distinct(neighborhood)
  )
```

    ## # A tibble: 1 × 3
    ##   total unique_zip unique_neighbor
    ##   <int>      <int>           <int>
    ## 1 16588        143              42

We can see that there are **171** zip codes that only `ZIP code`
dataset. For example, zip code like 10008, 10020, 10041, 10043, 10045,
and 10047 only occur in `ZIP code` dataset. Some of zip codes are
missing from `Zillow` because they don’t have rentable housing. Besides,
zip codes from `ZIP code` dataset isfrom 2007, whereas zip codes from
`Zillow` are from 2015 onward. Hence, some zip codes may no longer
exist.

``` r
leftonly_zips =
  zip_code_df |> 
  distinct(zip_code) |> 
  anti_join(
    zori_df |> distinct(zip_code),
    by = "zip_code"
  ) |> 
  arrange(zip_code)

head(leftonly_zips)
```

    ## # A tibble: 6 × 1
    ##   zip_code
    ##      <dbl>
    ## 1    10008
    ## 2    10020
    ## 3    10041
    ## 4    10043
    ## 5    10045
    ## 6    10047

``` r
n_distinct(leftonly_zips$zip_code)
```

    ## [1] 171

Below are the table for 10 largest drop in price from January 2020 to
2021. All top ten largest drops are in Manhattan, mostly clustered in
Lower Manhattan and Midtown. The big drops make sense: remote work kept
people out of the offices, and the pandemic erased tourist traffic
around business districts and major attractions.

``` r
table_top10 = 
  combined_zillow |>
  filter(month(date) == 1, year(date) %in% c(2020, 2021)) |>
  mutate(year = year(date)) |>
  select(-date) |>
  pivot_wider(
    names_from = year, 
    values_from = value
    ) |>
  rename(Jan_2020 = `2020`, Jan_2021 = `2021`) |>
  mutate(
    decrease = Jan_2020 - Jan_2021
    ) |>
  arrange(desc(decrease))

table_top10 |> 
  slice_head(n = 10) |> 
  knitr::kable()
```

| zip_code | borough   | neighborhood                  | Jan_2020 | Jan_2021 | decrease |
|---------:|:----------|:------------------------------|---------:|---------:|---------:|
|    10007 | Manhattan | Lower Manhattan               | 6334.211 | 5421.614 | 912.5966 |
|    10069 | Manhattan | NA                            | 4623.042 | 3874.918 | 748.1245 |
|    10009 | Manhattan | Lower East Side               | 3406.442 | 2692.187 | 714.2550 |
|    10016 | Manhattan | Gramercy Park and Murray Hill | 3731.135 | 3019.431 | 711.7045 |
|    10001 | Manhattan | Chelsea and Clinton           | 4108.098 | 3397.648 | 710.4499 |
|    10002 | Manhattan | Lower East Side               | 3645.416 | 2935.113 | 710.3028 |
|    10004 | Manhattan | Lower Manhattan               | 3149.658 | 2443.697 | 705.9608 |
|    10038 | Manhattan | Lower Manhattan               | 3573.201 | 2875.616 | 697.5853 |
|    10012 | Manhattan | Greenwich Village and Soho    | 3628.566 | 2942.344 | 686.2218 |
|    10010 | Manhattan | Gramercy Park and Murray Hill | 3697.284 | 3012.353 | 684.9304 |
